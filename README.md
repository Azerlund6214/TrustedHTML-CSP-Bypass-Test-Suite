# TrustedHTML-CSP-Bypass-Test-Suite

–ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ç–æ–¥–æ–≤ –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è TrustedHTML –≤ —É—Å–ª–æ–≤–∏—è—Ö —Å—Ç—Ä–æ–≥–æ–π Content Security Policy (CSP) –±—Ä–∞—É–∑–µ—Ä–æ–≤.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é HTML-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –≤—Å—Ç–∞–≤–∫–µ –∏—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –æ–±—Ö–æ–¥—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ **`TrustedHTML`**, –≤–≤–µ–¥—ë–Ω–Ω–æ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏ (Chrome 95+) –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (CSP).

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –ø—Ä—è–º–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ HTML —á–µ—Ä–µ–∑ `innerHTML` –∏ –ø–æ–¥–æ–±–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞, —Ç—Ä–µ–±—É—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ `TrustedHTML`, —á—Ç–æ –ª–æ–º–∞–µ—Ç –º–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

## üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã

–¢–µ—Å—Ç–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|----------|-------------------|
| **1. createElement + appendChild** | –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ DOM API | –í—Å–µ–≥–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **2. insertAdjacentHTML** | –í—Å—Ç–∞–≤–∫–∞ HTML —Ä—è–¥–æ–º —Å —ç–ª–µ–º–µ–Ω—Ç–æ–º | –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π HTML |
| **3. outerHTML** | –ó–∞–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ü–µ–ª–∏–∫–æ–º | –î–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–º–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| **4. document.write (iframe)** | –ß–µ—Ä–µ–∑ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π iframe | –î–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| **5. DOMParser** | –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –≤ DOM-–¥–æ–∫—É–º–µ–Ω—Ç | –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä |
| **6. –¢–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã** | –ß–µ—Ä–µ–∑ createTextNode + createElement | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞** –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
   - `F12` –∏–ª–∏ `Ctrl+Shift+I`
   - –í–∫–ª–∞–¥–∫–∞ **Console**

2. **–í—Å—Ç–∞–≤—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥ —Ç–µ—Å—Ç–µ—Ä–∞:**

'''javascript
// –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
const results = testInnerHTMLBypass();
'''

3. **–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Ç–æ–¥:**

'''javascript
// –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ (1-6)
quickTest(1); // –ú–µ—Ç–æ–¥ createElement
quickTest(5); // –ú–µ—Ç–æ–¥ DOMParser
'''

## üìù –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–µ—Ä –≤—ã–≤–æ–¥–∏—Ç:
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–µ –º–µ—Ç–æ–¥—ã** ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSP
- ‚ùå **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã** ‚Äî –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** ‚Äî —Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –≤—Å–µ—Ö —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CSP –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∞–π—Ç–∞
'''javascript
// 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
// 2. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–µ—Ä –≤ –∫–æ–Ω—Å–æ–ª—å
testInnerHTMLBypass();

// 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
// 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã –≤ —Å–≤–æ—ë–º –∫–æ–¥–µ
'''

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
'''javascript
// –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Å–≤–æ–π —Å–∫—Ä–∏–ø—Ç —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
function safeCreateElement(tag, attributes = {}, children = []) {
    const element = document.createElement(tag);
    
    // –ê—Ç—Ä–∏–±—É—Ç—ã
    Object.entries(attributes).forEach(([key, value]) => {
        if (key === 'style' && typeof value === 'object') {
            Object.assign(element.style, value);
        } else if (key.startsWith('on')) {
            element[key] = value;
        } else {
            element.setAttribute(key, value);
        }
    });
    
    // –î–µ—Ç–∏
    children.forEach(child => {
        if (typeof child === 'string') {
            element.appendChild(document.createTextNode(child));
        } else if (child instanceof Node) {
            element.appendChild(child);
        }
    });
    
    return element;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const button = safeCreateElement('button', 
    { 
        id: 'my-btn',
        style: { color: 'white', background: 'blue' },
        onclick: () => alert('Clicked!')
    },
    ['–ù–∞–∂–º–∏ –º–µ–Ω—è']
);

document.body.appendChild(button);
'''

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ TrustedHTML?
–ë—Ä–∞—É–∑–µ—Ä—ã –≤–Ω–µ–¥—Ä–∏–ª–∏ Trusted Types API –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS-–∞—Ç–∞–∫. –ö–æ–≥–¥–∞ —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥—É—é CSP —Å –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π `require-trusted-types-for 'script'`, –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç:
- `innerHTML`
- `outerHTML`
- `insertAdjacentHTML`
- `document.write`

### –ö–∞–∫ —Ç–µ—Å—Ç–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å?
1. –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
2. –ü—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –≤—ã–∑–≤–∞–ª–æ –ª–∏ —ç—Ç–æ –æ—à–∏–±–æ–∫
4. –£–¥–∞–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

## üìã –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

`` `
üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–ø–æ—Å–æ–±—ã –æ–±—Ö–æ–¥–∞ CSP –¥–ª—è innerHTML...
==================================================
1. createElement + appendChild: ‚úÖ –£—Å–ø–µ—Ö
2. insertAdjacentHTML: ‚ùå –û—à–∏–±–∫–∞: Failed to set the 'innerHTML' property...
3. outerHTML: ‚ùå –û—à–∏–±–∫–∞: Failed to set the 'outerHTML' property...
4. document.write (iframe): ‚úÖ –£—Å–ø–µ—Ö
5. DOMParser: ‚úÖ –£—Å–ø–µ—Ö
6. –¢–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã + createElement: ‚úÖ –£—Å–ø–µ—Ö
==================================================
üìä –†–∞–±–æ—Ç–∞—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤: 4 –∏–∑ 6
üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã —Å –ø–æ–º–µ—Ç–∫–æ–π "‚úÖ –£—Å–ø–µ—Ö"
–õ—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è UI:
1. createElement + appendChild (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç)
2. DOMParser + appendChild (–≥–∏–±–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ HTML)
'''

## üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–¢–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä:** –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–µ –±—Ä–∞—É–∑–µ—Ä–∞
- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç CSP:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–∞–π—Ç–∞
- **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π:** –ú–µ—Ç–æ–¥—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è, –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤

## ü§ù –í–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ.

---

## üîó –°—Å—ã–ª–∫–∏ –ø–æ —Ç–µ–º–µ

- [Trusted Types –Ω–∞ MDN](https://developer.mozilla.org/en-US/docs/Web/API/Trusted_Types_API)
- [Content Security Policy Level 3](https://www.w3.org/TR/CSP3/)
- [Google Developers: Trusted Types](https://web.dev/trusted-types/)

---

**–í–µ—Ä—Å–∏—è:** v1.0  
**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—á–∏–π (–ù–∞—à–µ–ª 2/5 –Ω–∞ —é—Ç—É–±–µ)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** dec.2025